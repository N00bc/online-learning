# 项目笔记

## Day3笔记：

JSR303校验：表单参数校验。

步骤：

1. 引入JSR303校验坐标

    ```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
    ```

2. 给DTO的属性上标注相应的校验注解常见注解如下：

    |           限制           |                             说明                             |
    | :----------------------: | :----------------------------------------------------------: |
    |         @NotNull         |                       限制必须不为Null                       |
    |       @AssertTrue        |                        限制必须为true                        |
    | @Max/@Min/@Size(max,min) |                            限制值                            |
    |        @NotEmpty         | 验证注解的元素值部位null且不为空（字符串长度不为0，集合大小不为0） |
    |        @NotBlank         | 验证注解的元素值不为空（不为null、去除首位空格后长度为0），不同于@NotEmpty，@NotBlank只应用于字符串且在比较时会去除字符串空格 |

3. 在前端控制器中加入 `@Validated`注解用于自动校验

4. 自定义注解如果报出异常需要在全局异常处理器中处理该异常逻辑如下

    ```java
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)// 返回状态码注解
    public RestErrorResponse doMethodArgumentNotValidException(MethodArgumentNotValidException exception) {
        BindingResult bindingResult = exception.getBindingResult();
        // 获取错误集合
        List<FieldError> fieldErrors = bindingResult.getFieldErrors();
        // 将错误信息收集
        StringBuffer errorMsg = new StringBuffer();
        fieldErrors.forEach(error -> errorMsg.append(error.getDefaultMessage()).append(","));
        log.error("捕获异常信息:{}", errorMsg);
        exception.printStackTrace();
        // 若发生系统内部异常则返回友好提示
        return new RestErrorResponse(errorMsg.toString());
    }
    ```


## Day4笔记：

Nacos最佳实践

1. namespace：命名空间，不同命名空间无法访问。一般用作环境隔离。如dev，test，pro
2. group：分组，一般用作项目隔离

在配置中心的配置项中

- ```yaml
    spring:
      cloud:
        nacos:
          config:
            server-addr: myvm:8848
            namespace: 8c24948e-ab38-40ee-a31b-4bf33447ac08
            group: online-learning
            file-extension: yaml
            extension-configs:
              - data-id: system-service-${spring.profiles.active}.yaml
                group: online-learning
    ```

    `extension-configs`：表示需要加载额外的配置文件。此项目中由于视图解析器和service层不在同一个模块开发，因此service有单独的模块即单独的配置文件，需要将它加载进来。

- 共享配置

    ```yaml
    shared-configs:
        - data-id: swagger-${spring.profiles.active}.yaml
        group: online-learning-common
        - data-id: logging-${spring.profiles.active}.yaml
        group: online-learning-common
    ```

    `shared-configs`：表示加载一些全局共享的配置文件。比如swagger，日志配置

配置文件的优先级：bootstrap.yml>云端>本地。打开`spring.cloud.config.override-none: true`配置，即可让本地配置最高（需要在nacos配置文件中配置）

## Day5笔记

Docker安装Minio

```shell
docker run -p 9000:9000 -p 9090:9090 \
 --name vm-minio \
 -d --restart=always \
 -e "MINIO_ACCESS_KEY=minioadmin" \
 -e "MINIO_SECRET_KEY=minioadmin" \
 -v /usr/local/src/docker/minio/data:/data \
 minio/minio server \
 /data --console-address ":9090" -address ":9000"
```

`RequestParam()`：用来处理请求头Content-Type: 为 application/x-www-form-urlencoded编码的内容，将请参数与对应的实体类映射

`RequestPart()`：支持的请求方法是MultipartFile，@RequestPart适用于复杂的请求域（像JSON，XML），既可以接收对象又可以接收二进制数据流。

### API：

- LocalTime now = LocalTime.now(); 获取当前的年月日
- DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern("yyyy/MM/dd"); 时间格式
- String format = now.format(dateTimeFormatter);  按照格式 格式化时间
- int i = "hello.txt".lastIndexOf("."); 返回 "."的下标
- String value = "hello.txt".substring(i); 返回从下标为i（包括i）后的字符串

## Day6笔记

Comparator接口的compare方法使用

```java
new Comparator<Integer>(){
    @Override
    public int compare(Integer o1, Integer o2) {
        // 升序
        return o1-02;
    }
}

```

